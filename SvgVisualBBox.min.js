/*! SvgVisualBBox.js v1.1.9 | MIT License | https://github.com/Emasoft/SVG-BBOX */
!function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof module&&module.exports?module.exports=t():e.SvgVisualBBox=t()}("undefined"!=typeof self?self:this,()=>{"use strict";const e=!1,t=new WeakMap;function n(e){return Boolean(e&&/^auto_id_/.test(e))}function i(e){if(!e)return"null/undefined element";const t=[],i=e.tagName||e.nodeName||"unknown";if(t.push(`<${i}>`),e.id){const i=n(e.id)?`id="${e.id}" (AUTO-GENERATED - not in original SVG!)`:`id="${e.id}"`;t.push(i)}e.getAttribute&&e.getAttribute("class")&&t.push(`class="${e.getAttribute("class")}"`);const o=e.parentNode;if(o&&o instanceof Element){const e=o.id?n(o.id)?` id="${o.id}" (AUTO-GENERATED)`:` id="${o.id}"`:"";t.push(`(child of <${o.tagName}>${e})`)}return t.join(" ")}function o(e,t){const i=e&&e.id&&n(e.id),o=e&&e.parentNode&&e.parentNode instanceof Element&&e.parentNode.id&&n(e.parentNode.id),r=t&&t.id&&n(t.id);if(!i&&!o&&!r)return"";!function(e){if(e)try{const t=(new XMLSerializer).serializeToString(e),n=(new Date).toISOString().replace(/[:.]/g,"-").replace("T","_").slice(0,-5),i=e.id||"svg";"undefined"!=typeof window&&(window.__DEBUG_SVG_DATA__={content:t,filename:`${i}_debug_${n}.svg`,timestamp:n})}catch(e){}}(t);const s=e&&e.id?e.id:"(none)",a=(new Date).toISOString().replace(/[:.]/g,"-").replace("T","_").slice(0,-5);return`\n‚ö†Ô∏è  AUTO-GENERATED ID WARNING:\n   The IDs shown above were automatically assigned by sbb-extract.cjs.\n   These IDs DO NOT EXIST in your original SVG file!\n\n   üîç DEBUG SVG WILL BE AUTOMATICALLY SAVED:\n   ${`${t&&t.id?t.id:"svg"}_debug_${a}.svg`}\n\n   To find this element in your original SVG:\n   1. Open the debug SVG file (saved automatically in current directory)\n   2. Search for the ID "${s}" to locate the problematic element\n   3. Note the element's position, visual appearance, and attributes\n   4. Find the corresponding element in your original SVG using these details\n`}function r(e){if(!e||"undefined"==typeof window||!window.getComputedStyle)return"unknown";try{const t=window.getComputedStyle(e);return t.fontFamily||t.getPropertyValue("font-family")||"default"}catch{return"error detecting font"}}async function waitForDocumentFonts(e,t){e||(e=document),"number"==typeof t&&isFinite(t)||(t=5e3);const n=e.fonts;if(!n||!n.ready)return;const i=n.ready;t<=0?await i:await Promise.race([i,new Promise(e=>setTimeout(()=>{e(void 0)},t))])}function s(e,t,n){const i=t.width/n.width,o=t.height/n.height,r=(e.getAttribute("preserveAspectRatio")||"xMidYMid meet").trim().split(/\s+/).filter(e=>"defer"!==e);if(1===r.length&&"none"===r[0])return{scaleX:i,scaleY:o,offsetX:0,offsetY:0,uniform:!1};const s=r[0]||"xMidYMid";let a;a="slice"===(r[1]||"meet")?Math.min(i,o):Math.max(i,o);const l=t.width/a,d=t.height/a,h=n.width-l,c=n.height-d;let u=0,f=0;return s.startsWith("xMid")?u=h/2:s.startsWith("xMax")&&(u=h),s.includes("YMid")?f=c/2:s.includes("YMax")&&(f=c),{scale:a,offsetX:u,offsetY:f,uniform:!0}}async function a(e,t,n,s){if(!e)throw new Error("rasterizeSvgElementToBBox: element parameter is null or undefined");if(!t)throw new Error("rasterizeSvgElementToBBox: svgRoot parameter is null or undefined");if(!n||"object"!=typeof n)throw new Error("rasterizeSvgElementToBBox: roi parameter must be an object with x, y, width, height");if(n.width<=0||n.height<=0)return null;if("number"!=typeof s||s<=0||!isFinite(s))throw new Error(`rasterizeSvgElementToBBox: pixelsPerUnit must be a positive finite number, got: ${s}`);const a=n,l=!!e.id;let d;l||(d="__svg_visual_bbox_tmp_"+Math.random().toString(36).slice(2),e.id=d);const h=t.cloneNode(!0);l||e.removeAttribute("id"),h.getAttribute("xmlns")||h.setAttribute("xmlns","http://www.w3.org/2000/svg"),h.setAttribute("viewBox",a.x+" "+a.y+" "+a.width+" "+a.height);const c=16384,u=Math.max(1,Math.round(a.width*s)),f=Math.max(1,Math.round(a.height*s));let g,m=s,w=u,y=f;if(u>c||f>c){const e=c/u,t=c/f,n=Math.min(e,t);m=s*n,w=Math.max(1,Math.round(a.width*m)),y=Math.max(1,Math.round(a.height*m))}if(h.setAttribute("width",String(w)),h.setAttribute("height",String(y)),h.setAttribute("preserveAspectRatio","none"),h.removeAttribute("x"),h.removeAttribute("y"),e===t)g=h;else{const t=d||e.id;g=h.getElementById(t)}if(!g){const n=i(e),r=d?`Temporary ID used: "${d}"`:"Element ID: "+(e.id?`"${e.id}"`:"(none)"),s=o(e,t);throw new Error(`‚ùå Cannot render SVG element: Element not found in cloned SVG\n\nELEMENT DETAILS:\n  ${n}\n  ${r}\n  SVG Root: ${t.id?`id="${t.id}"`:"(no id)"}\n`+s+"\nThis typically happens when:\n  1. The element IS the SVG root itself (not supported - query a child element instead)\n  2. The element was removed or modified during cloning\n  3. The element's ID conflicts with another element\n\nHow to fix:\n  ‚Ä¢ If querying the root <svg>, query a child element instead\n  ‚Ä¢ Ensure the element has a unique 'id' attribute\n  ‚Ä¢ Check that the element exists in the DOM before calling this function\n  ‚Ä¢ Verify the element hasn't been dynamically removed")}const p=new Set;let x=g;for(;x&&(p.add(x),x!==h);)x=x.parentNode;!function e(t){p.add(t);const n=t.children;for(let t=0;t<n.length;t++){const i=n[t];i&&e(i)}}(g),function e(t){const n=t.getAttribute&&t.getAttribute("xlink:href"),i=t.getAttribute&&t.getAttribute("href");for(const e of[n,i])if(e&&e.startsWith("#")){const t=e.substring(1);let n=h.getElementById(t);if(!n){const e=document.getElementById(t);if(e){let t=h.querySelector("defs");t||(t=document.createElementNS("http://www.w3.org/2000/svg","defs"),h.insertBefore(t,h.firstChild)),n=e.cloneNode(!0),t.appendChild(n),p.add(t)}}if(n&&!p.has(n)){p.add(n);let e=n.parentNode;for(;e&&e!==h;)p.add(e),e=e.parentNode}}const o=t.getAttribute&&t.getAttribute("style");if(o){const e=o.match(/url\(#([^)]+)\)/g);if(e)for(const t of e){const e=t.match(/url\(#([^)]+)\)/);if(!e)continue;const n=e[1];if(!n)continue;const i=h.getElementById(n);if(i&&!p.has(i)){p.add(i);let e=i.parentNode;for(;e&&e!==h;)p.add(e),e=e.parentNode}}}const r=t.children;for(let t=0;t<r.length;t++){const n=r[t];n&&e(n)}}(g);const b=g.tagName&&g.tagName.toLowerCase();if("tspan"===b||"textpath"===b){const e=g.parentNode;if(e){const t=Array.from(e.children);for(const e of t){const t=e.tagName&&e.tagName.toLowerCase();"tspan"!==t&&"textpath"!==t||(p.add(e),function e(t){p.add(t);const n=t.children;for(let t=0;t<n.length;t++){const i=n[t];i&&e(i)}}(e))}}}!function e(t){const n=Array.prototype.slice.call(t.children);for(let t=0;t<n.length;t++){const i=n[t];"defs"!==(i.tagName&&i.tagName.toLowerCase())&&(p.has(i)||i.contains(g)?e(i):i.parentNode.removeChild(i))}}(h);const v=(new XMLSerializer).serializeToString(h);const E=new Blob([v],{type:"image/svg+xml;charset=utf-8"}),S=URL.createObjectURL(E),M=new Image;let $,V=null,B=null;try{if(M.decoding="async",M.crossOrigin="anonymous",M.src=S,await new Promise((n,s)=>{M.onload=function(){M.onload=null,M.onerror=null,n(void 0)},M.onerror=function(n){M.onload=null,M.onerror=null;const a=n&&"object"==typeof n&&"message"in n?String(n.message):"unknown error",l=i(e),d=r(e),h=o(e,t);s(new Error(`‚ùå Failed to render SVG as image: ${a}\n\nELEMENT DETAILS:\n  ${l}\n  Font-family: ${d}\n  SVG Root: ${t.id?`id="${t.id}"`:"(no id)"}\n`+h+"\nThis can happen when:\n  1. The SVG contains invalid XML syntax\n  2. Referenced resources (images, fonts) failed to load\n  3. The SVG uses unsupported features\n  4. Browser security policies blocked the rendering\n\nHow to fix:\n  ‚Ä¢ Validate your SVG with an XML validator\n  ‚Ä¢ Check that all external resources (images, fonts) are accessible\n  ‚Ä¢ Ensure referenced elements (gradients, patterns, etc.) exist in <defs>\n  ‚Ä¢ If fonts are missing, ensure they are installed or embedded in the SVG\n  ‚Ä¢ Try simplifying the SVG to isolate the problematic element"))}}),V=document.createElement("canvas"),V.width=w,V.height=y,B=V.getContext("2d"),!B)throw new Error("Failed to get canvas 2D context");B.clearRect(0,0,w,y),B.drawImage(M,0,0,w,y)}finally{URL.revokeObjectURL(S),M.src="",M.onload=null,M.onerror=null}try{if(!B)throw new Error("Canvas context is null");$=B.getImageData(0,0,w,y)}catch(n){const s=n instanceof Error?n.message:"",l=/out of memory/i.test(s),d=/tainted/i.test(s);if(l){const n=i(e),r=o(e,t);throw new Error(`‚ùå Cannot render SVG: Canvas out of memory\n\nELEMENT DETAILS:\n  ${n}\n  SVG Root: ${t.id?`id="${t.id}"`:"(no id)"}\n`+r+"\nThe SVG coordinates or dimensions are too large for canvas rasterization.\n"+`Current viewBox: ${a.x} ${a.y} ${a.width} ${a.height}\n`+`Attempted canvas size: ${w}√ó${y} pixels\n\nHow to fix:\n  ‚Ä¢ Reduce the viewBox dimensions to a reasonable size (< 10,000 units)\n  ‚Ä¢ Use smaller coordinates (avoid values > 100,000)\n  ‚Ä¢ Decrease the pixelsPerUnit scaling factor\n  ‚Ä¢ Split large SVG into smaller regions and process separately\n\n`+`Original error: ${s}`)}if(d){const n=i(e),a=r(e),l=o(e,t);throw new Error(`‚ùå Cannot read SVG pixels: Canvas is tainted by cross-origin resources\n\nELEMENT DETAILS:\n  ${n}\n  Font-family: ${a}\n  SVG Root: ${t.id?`id="${t.id}"`:"(no id)"}\n`+l+"\nThis happens when your SVG references external resources without CORS:\n  ‚Ä¢ External images (PNG, JPG, etc.) from different domains\n  ‚Ä¢ Web fonts from CDNs without proper CORS headers\n  ‚Ä¢ SVG <use> elements referencing external files\n\nHow to fix:\n  ‚Ä¢ Host images/fonts on the same domain as your page\n  ‚Ä¢ Configure CORS headers on external resources (Access-Control-Allow-Origin: *)\n  ‚Ä¢ Use data URLs for images instead of external URLs\n  ‚Ä¢ Embed fonts directly in the SVG using @font-face with data URLs\n"+`  ‚Ä¢ If using web fonts (like "${a}"), ensure they have CORS headers or embed them\n\n`+`Original error: ${s}`)}const h=i(e),c=r(e),u=o(e,t);throw new Error(`‚ùå Cannot read SVG pixels from canvas\n\nELEMENT DETAILS:\n  ${h}\n  Font-family: ${c}\n  SVG Root: ${t.id?`id="${t.id}"`:"(no id)"}\n`+u+"\n"+`Error: ${s||"unknown canvas error"}\n\nCommon causes:\n  ‚Ä¢ Cross-origin images/fonts without CORS (canvas becomes "tainted")\n  ‚Ä¢ Canvas size too large (out of memory)\n  ‚Ä¢ Browser security restrictions\n\nHow to fix:\n  ‚Ä¢ Check browser console for specific CORS errors\n  ‚Ä¢ Ensure all external resources are same-origin or have CORS enabled\n  ‚Ä¢ Try reducing the SVG size or complexity`)}const A=$.data;let G=w,T=-1,C=y,R=-1;for(let e=0;e<y;e++){const t=e*w*4;for(let n=0;n<w;n++){0!==A[t+4*n+3]&&(n<G&&(G=n),n>T&&(T=n),e<C&&(C=e),e>R&&(R=e))}}if(T<G||R<C)return null;const I=a.x+G/m;return{x:I,y:a.y+C/m,width:(T-G+1)/m,height:(R-C+1)/m}}async function getSvgElementVisualBBoxTwoPassAggressive(o,r){const l=(r=r||{}).mode||"clipped",d="number"==typeof r.coarseFactor?r.coarseFactor:3,h="number"==typeof r.fineFactor?r.fineFactor:24,c="number"==typeof r.safetyMarginUser?r.safetyMarginUser:null,u="boolean"!=typeof r.useLayoutScale||r.useLayoutScale,f="number"==typeof r.fontTimeoutMs?r.fontTimeoutMs:5e3,g="string"==typeof o?document.getElementById(o):o;if(!g){throw new Error(`‚ùå Cannot compute SVG bounding box: Element not found\n\nREQUESTED ELEMENT:\n  ${"string"==typeof o?`id="${o}"`:"provided reference"}\n  Type: ${typeof o}\n\nHow to fix:\n  ‚Ä¢ Check that the element exists in the DOM\n  ‚Ä¢ Verify the element ID is correct (case-sensitive)\n  ‚Ä¢ Ensure the element hasn't been removed from the DOM\n  ‚Ä¢ If passing an element reference, make sure it's not null/undefined`)}const m=t.get(g);m&&await m;let w=e=>{};const y=new Promise(e=>{w=e});t.set(g,y);try{const t=g.ownerDocument||document;await waitForDocumentFonts(t,f);const o=g.ownerSVGElement||(g instanceof SVGSVGElement?g:null);if(!o){const e=i(g),t=g&&g.id&&n(g.id)?`\n‚ö†Ô∏è  NOTE: This element has an AUTO-GENERATED ID ("${g.id}").\n   This ID was added by sbb-extract.cjs and doesn't exist in your original SVG.\n\n`:"";throw new Error(`‚ùå Cannot compute SVG bounding box: Element is not inside an SVG tree\n\nELEMENT DETAILS:\n  ${e}\n`+t+"This element is not connected to an <svg> root element.\n\nHow to fix:\n  ‚Ä¢ Ensure the element is inside an <svg> tag in the DOM\n  ‚Ä¢ Check that you're not querying a detached/orphaned element\n  ‚Ä¢ If creating elements programmatically, append them to the SVG tree first\n  ‚Ä¢ Verify the element hasn't been removed from the document")}const r=o.viewBox&&o.viewBox.baseVal;let m;if(r&&r.width&&r.height)m={x:r.x,y:r.y,width:r.width,height:r.height};else{const e=function(e){try{const t=e.getBoundingClientRect(),n=e.ownerSVGElement||(e instanceof SVGSVGElement?e:null);if(!n||!t)return null;if(0===t.width&&0===t.height)return null;const i=n.getBoundingClientRect(),o=n.viewBox&&n.viewBox.baseVal;if(!o||o.width<=0||o.height<=0)return null;if(i.width<=0||i.height<=0)return null;const r=s(n,o,i);let a,l,d,h;if(r.uniform){const e=r.scale;a=o.x+(t.left-i.left-r.offsetX)*e,l=o.y+(t.top-i.top-r.offsetY)*e,d=t.width*e,h=t.height*e}else a=o.x+(t.left-i.left)*r.scaleX,l=o.y+(t.top-i.top)*r.scaleY,d=t.width*r.scaleX,h=t.height*r.scaleY;return isFinite(a)&&isFinite(l)&&isFinite(d)&&isFinite(h)?{x:a,y:l,width:d,height:h}:null}catch{return null}}(o);m=e?{x:e.x,y:e.y,width:e.width,height:e.height}:{x:-2e3,y:-2e3,width:4e3,height:4e3}}const w=[];let y;if(function e(t){const n=t.getAttribute&&t.getAttribute("xlink:href"),i=t.getAttribute&&t.getAttribute("href");for(const e of[n,i])if(e&&e.startsWith("#")){const t=e.substring(1),n=o.getElementById(t);n&&!w.includes(n)&&w.push(n)}const r=t.getAttribute&&t.getAttribute("style");if(r){const e=r.match(/url\(#([^)]+)\)/g);if(e)for(const t of e){const e=t.match(/url\(#([^)]+)\)/);if(!e)continue;const n=e[1];if(!n)continue;const i=o.getElementById(n);i&&!w.includes(i)&&w.push(i)}}const s=t.children;for(let t=0;t<s.length;t++)e(s[t])}(g),"unclipped"===l){let e=m.x,t=m.y,n=m.x+m.width,i=m.y+m.height;const r=s(o,m,o.getBoundingClientRect()),a=s=>{try{const a=s.getBoundingClientRect(),l=o.getBoundingClientRect();if(a.width>0&&a.height>0){let o,s,d,h;if(r.uniform){const e=r.scale;o=m.x+(a.left-l.left-r.offsetX)*e,s=m.y+(a.top-l.top-r.offsetY)*e,d=m.x+(a.right-l.left-r.offsetX)*e,h=m.y+(a.bottom-l.top-r.offsetY)*e}else o=m.x+(a.left-l.left)*r.scaleX,s=m.y+(a.top-l.top)*r.scaleY,d=m.x+(a.right-l.left)*r.scaleX,h=m.y+(a.bottom-l.top)*r.scaleY;const c=200;e=Math.min(e,o-c),t=Math.min(t,s-c),n=Math.max(n,d+c),i=Math.max(i,h+c)}}catch{}};a(g);for(const e of w)a(e);y={x:e,y:t,width:n-e,height:i-t}}else y={x:m.x,y:m.y,width:m.width,height:m.height};let p=1;if(u&&m.width>0&&m.height>0){const e=o.getBoundingClientRect();if(e&&e.width>0&&e.height>0){const t=e.width/m.width;p=(t+e.height/m.height)/2}}const x=Math.max(1,p*d),b=Math.max(4,p*h);e;const v=await a(g,o,y,x);if(!v)return null;let E=c;if(null==E||!isFinite(E)){const e=Math.max(v.width,v.height);E=100+(e>0?.25*e:0)}const S=v.x-E,M=v.y-E,$=v.x+v.width+E,V=v.y+v.height+E,B={x:S,y:M,width:Math.max(0,$-S),height:Math.max(0,V-M)};if(B.width<=0||B.height<=0)return null;const A=await a(g,o,B,b);return A?{x:A.x,y:A.y,width:A.width,height:A.height,element:g,svgRoot:o}:null}finally{w(),t.delete(g)}}async function getSvgElementsUnionVisualBBox(e,t){if(!Array.isArray(e)||0===e.length)throw new Error(`Cannot compute union bounding box: Invalid targets parameter\n\nExpected: Non-empty array of SVG elements or element IDs\nReceived: ${Array.isArray(e)?"empty array":typeof e}\n\nHow to fix:\n  ‚Ä¢ Pass an array with at least one element\n  ‚Ä¢ Example: ['element1', 'element2'] or [el1, el2]\n  ‚Ä¢ Ensure the array is not empty before calling this function`);const n=[];let i=null;for(let o=0;o<e.length;o++){const r=e[o];if(!r)continue;const s=await getSvgElementVisualBBoxTwoPassAggressive(r,t);if(s){if(i){if(s.svgRoot!==i){const e=i.id?`id="${i.id}"`:"(no id)",t=s.svgRoot.id?`id="${s.svgRoot.id}"`:"(no id)";throw new Error(`Cannot compute union bounding box: Elements from different SVG documents\n\nAll elements must belong to the same <svg> root element.\nPrevious SVG: ${e}\nCurrent SVG:  ${t}\n\nHow to fix:\n  ‚Ä¢ Ensure all elements are children of the same <svg> root\n  ‚Ä¢ If you have multiple SVGs, compute bbox for each separately\n  ‚Ä¢ Check that elements haven't been moved between different SVG trees`)}}else i=s.svgRoot;n.push(s)}}if(0===n.length)return null;let o=1/0,r=1/0,s=-1/0,a=-1/0;for(let e=0;e<n.length;e++){const t=n[e];t&&(o=Math.min(o,t.x),r=Math.min(r,t.y),s=Math.max(s,t.x+t.width),a=Math.max(a,t.y+t.height))}return i?{x:o,y:r,width:s-o,height:a-r,svgRoot:i,bboxes:n}:null}async function getSvgElementVisibleAndFullBBoxes(e,t){t=t||{};const n=Object.assign({},t,{mode:"clipped"}),i=Object.assign({},t,{mode:"unclipped"});return{visible:await getSvgElementVisualBBoxTwoPassAggressive(e,n),full:await getSvgElementVisualBBoxTwoPassAggressive(e,i)}}return{waitForDocumentFonts:waitForDocumentFonts,getSvgElementVisualBBoxTwoPassAggressive:getSvgElementVisualBBoxTwoPassAggressive,getSvgElementsUnionVisualBBox:getSvgElementsUnionVisualBBox,getSvgElementVisibleAndFullBBoxes:getSvgElementVisibleAndFullBBoxes,getSvgRootViewBoxExpansionForFullDrawing:async function(e,t){t=t||{};const n="string"==typeof e?document.getElementById(e):e;if(!(n&&n instanceof SVGSVGElement)){throw new Error(`Cannot compute viewBox expansion: Invalid SVG root (${"string"==typeof e?`id="${e}"`:"provided reference"})\n\nExpected: Root <svg> element or its ID\nReceived: ${n?n.tagName:"null/undefined"}\n\nHow to fix:\n  ‚Ä¢ Pass the root <svg> element or its ID string\n  ‚Ä¢ Ensure the element is actually an <svg> tag, not a child element\n  ‚Ä¢ Check that the element exists in the DOM`)}const i=n.viewBox&&n.viewBox.baseVal;if(!i||!i.width||!i.height){const e=n.id?`id="${n.id}"`:"(no id)";throw new Error(`Cannot compute viewBox expansion: SVG missing valid viewBox (${e})\n\nThe root <svg> element must have a viewBox attribute with valid dimensions.\nCurrent viewBox: ${n.getAttribute("viewBox")||"(none)"}\n\nHow to fix:\n  ‚Ä¢ Add a viewBox attribute to your <svg> tag\n  ‚Ä¢ Example: <svg viewBox="0 0 800 600" ...>\n  ‚Ä¢ Ensure viewBox has 4 numbers: x, y, width, height\n  ‚Ä¢ Width and height must be greater than 0\n  ‚Ä¢ Use the sbb-fix-viewbox.cjs tool to auto-generate viewBox`)}const o={x:i.x,y:i.y,width:i.width,height:i.height},r=await getSvgElementVisibleAndFullBBoxes(n,t),s=r.visible,a=r.full;if(!a)return null;const l=o.x+o.width,d=o.y+o.height,h=a.x+a.width,c=a.y+a.height,u=Math.max(0,o.x-a.x),f=Math.max(0,o.y-a.y),g=Math.max(0,h-l),m=Math.max(0,c-d);return{currentViewBox:o,visibleBBox:s,fullBBox:a,padding:{left:u,top:f,right:g,bottom:m},newViewBox:{x:o.x-u,y:o.y-f,width:o.width+u+g,height:o.height+f+m}}},showTrueBBoxBorder:async function(e,t){t=t||{};let n=null;if("string"==typeof e){if(n=document.querySelector(e),!n)throw new Error(`SVG element not found: ${e}`)}else{if(!(e instanceof Element))throw new Error("Target must be a selector string or DOM element");n=e}if("object"===n.tagName.toLowerCase()&&"contentDocument"in n&&n.contentDocument){const e=n.contentDocument.querySelector("svg");e&&(n=e)}else if("iframe"===n.tagName.toLowerCase()&&"contentDocument"in n&&n.contentDocument){const e=n.contentDocument.querySelector("svg");e&&(n=e)}else n.tagName.toLowerCase();if(!n||!("ownerSVGElement"in n)&&"svg"!==n.tagName.toLowerCase())throw new Error("Target is not an SVG element or does not contain SVG content");const i=t.theme||"auto";let o=!1;"auto"===i?o=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches:"dark"===i?o=!0:"light"===i&&(o=!1);const r=o?"rgba(255,255,255,0.8)":"rgba(0,0,0,0.6)",s=t.borderColor||r,a=t.borderWidth||"2px",l=t.borderStyle||"dashed",d=void 0!==t.padding?t.padding:4,h=void 0!==t.zIndex?t.zIndex:999999,c=t.bboxOptions||{},u=await getSvgElementVisualBBoxTwoPassAggressive(n,c);if(!u||0===u.width||0===u.height)return console.warn("showTrueBBoxBorder: Element has zero-size bounding box",u),null;const f=("ownerSVGElement"in n?n.ownerSVGElement:null)||n,g=f.getBoundingClientRect(),m=f.viewBox.baseVal;let w=0,y=0,p=g.width,x=g.height;m&&m.width>0&&m.height>0&&(w=m.x,y=m.y,p=m.width,x=m.height);let b=g.width/p,v=g.height/x,E=0,S=0;const M=f.getAttribute("preserveAspectRatio")||"xMidYMid meet";if("none"!==M){const e="meet"===(M.includes("slice")?"slice":"meet")?Math.min(b,v):Math.max(b,v),t=p*e,n=x*e;M.includes("xMid")?E=(g.width-t)/2:M.includes("xMax")&&(E=g.width-t),M.includes("YMid")?S=(g.height-n)/2:M.includes("YMax")&&(S=g.height-n),b=e,v=e}const $=g.left+E+(u.x-w)*b-d,V=g.top+S+(u.y-y)*v-d,B=u.width*b+2*d,A=u.height*v+2*d,G=document.createElement("div");G.style.position="fixed",G.style.left=`${$}px`,G.style.top=`${V}px`,G.style.width=`${B}px`,G.style.height=`${A}px`,G.style.border=`${a} ${l} ${s}`,G.style.pointerEvents="none",G.style.zIndex=String(h),G.style.boxSizing="border-box",G.setAttribute("data-svg-bbox-overlay","true"),G.setAttribute("data-target-id",n.id||"anonymous"),document.body.appendChild(G);const T=()=>{const e=f.getBoundingClientRect(),t=e.width/p,n=e.height/x,i=e.left+(u.x-w)*t-d,o=e.top+(u.y-y)*n-d,r=u.width*t+2*d,s=u.height*n+2*d;G.style.left=`${i}px`,G.style.top=`${o}px`,G.style.width=`${r}px`,G.style.height=`${s}px`},C=()=>T(),R=()=>T();return window.addEventListener("scroll",C,!0),window.addEventListener("resize",R),{bbox:u,overlay:G,remove:()=>{G.parentNode&&G.parentNode.removeChild(G),window.removeEventListener("scroll",C,!0),window.removeEventListener("resize",R)}}},setViewBoxOnObjects:async function(e,t,n){const i={aspect:(n=n||{}).aspect||"stretch",aspectRatioMode:n.aspectRatioMode||"meet",align:n.align||"xMidYMid",visibility:n.visibility||"unchanged",visibilityList:n.visibilityList||null,margin:n.margin||0,saveVisibilityList:n.saveVisibilityList||!1,dryRun:n.dryRun||!1,bboxOptions:n.bboxOptions||{}};let o;if("string"==typeof e){const t=e.startsWith("#")?e:"#"+e;o=document.querySelector(t),o||(o=document.getElementById(e))}else o=e;if(!o||"svg"!==o.tagName.toLowerCase())throw new Error("Target must be an SVG element");const r=Array.isArray(t)?t:[t];if(0===r.length)throw new Error("At least one object ID must be provided");const s=r.map(e=>{let t=document.getElementById(e);if(!t)throw new Error(`Element with ID "${e}" not found`);if("symbol"===t.tagName.toLowerCase()){const n=Array.from(o.querySelectorAll("use")).filter(t=>(t.getAttribute("href")||t.getAttributeNS("http://www.w3.org/1999/xlink","href"))==="#"+e);if(0===n.length)throw new Error(`Symbol "${e}" has no <use> elements referencing it`);if(n.length>1)throw new Error(`Symbol "${e}" is referenced by multiple <use> elements. Please specify the exact <use> element ID.`);const i=n[0];if(!i)throw new Error(`Symbol "${e}" has no <use> elements referencing it`);t=i}return t}),a=i.bboxOptions||{};let l;if(await waitForDocumentFonts(document,a.fontTimeoutMs||8e3),1===s.length){const e=s[0];if(!e)throw new Error("No element found");l=await getSvgElementVisualBBoxTwoPassAggressive(e,a)}else{const e=s.filter(e=>null!=e);l=await getSvgElementsUnionVisualBBox(e,a)}if(!l||l.width<=0||l.height<=0)throw new Error("Could not compute valid bounding box for specified objects");const d=o.viewBox.baseVal,h={x:d.x||0,y:d.y||0,width:d.width||parseFloat(o.getAttribute("width")||"0")||0,height:d.height||parseFloat(o.getAttribute("height")||"0")||0};if(0===h.width||0===h.height){const e=o.getBoundingClientRect();h.width=e.width,h.height=e.height}let c,u=0;if("string"==typeof i.margin){const e=i.margin.match(/^(-?[\d.]+)(px|%)?$/);if(e&&e[1]){const t=parseFloat(e[1]),n=e[2];if("px"===n){u=t/(o.getBoundingClientRect().width/h.width)}else if("%"===n){u=t/100*Math.sqrt(l.width*l.width+l.height*l.height)}else u=t}}else u=i.margin;if("stretch"===i.aspect)c={x:l.x-u,y:l.y-u,width:l.width+2*u,height:l.height+2*u};else if("changePosition"===i.aspect){const e=l.x+l.width/2,t=l.y+l.height/2;c={x:e-h.width/2,y:t-h.height/2,width:h.width,height:h.height}}else{if("preserveAspectRatio"!==i.aspect)throw new Error(`Unknown aspect mode: ${i.aspect}`);{const e=h.width/h.height,t=(l.width+2*u)/(l.height+2*u);let n,o;"meet"===i.aspectRatioMode?e>t?(o=l.height+2*u,n=o*e):(n=l.width+2*u,o=n/e):e>t?(n=l.width+2*u,o=n/e):(o=l.height+2*u,n=o*e);const r=l.x+l.width/2,s=l.y+l.height/2,a=i.align.match(/^x(Min|Mid|Max)Y(Min|Mid|Max)$/),d=a?a[1]:"Mid",f=a?a[2]:"Mid";let g,m;g="Min"===d?l.x-u:"Max"===d?l.x+l.width+u-n:r-n/2,m="Min"===f?l.y-u:"Max"===f?l.y+l.height+u-o:s-o/2,c={x:g,y:m,width:n,height:o}}}let f=null;if(i.saveVisibilityList){const e={};o.querySelectorAll("[id]").forEach(t=>{if(t instanceof HTMLElement||t instanceof SVGElement){const n=window.getComputedStyle(t);e[t.id]={display:t.style.display||n.display,visibility:t.style.visibility||n.visibility,opacity:t.style.opacity||n.opacity}}}),f=e}const g={};if("unchanged"!==i.visibility&&!i.dryRun)if("hideAllExcept"===i.visibility){o.querySelectorAll("[id]").forEach(e=>{(e instanceof HTMLElement||e instanceof SVGElement)&&(g[e.id]=e.style.display,r.includes(e.id)||(e.style.display="none"))})}else if("hideTargets"===i.visibility)s.forEach(e=>{(e instanceof HTMLElement||"undefined"!=typeof SVGElement&&e instanceof SVGElement)&&(g[e.id]=e.style.display,e.style.display="none")});else if("restoreList"===i.visibility&&i.visibilityList){const e=i.visibilityList;Object.keys(e).forEach(t=>{const n=document.getElementById(t);if(n){const i=e[t];if(!i)return;g[t]={display:n.style.display,visibility:n.style.visibility,opacity:n.style.opacity},void 0!==i.display&&(n.style.display=i.display),void 0!==i.visibility&&(n.style.visibility=i.visibility),void 0!==i.opacity&&(n.style.opacity=i.opacity)}})}const m=`${h.x} ${h.y} ${h.width} ${h.height}`;return i.dryRun||o.setAttribute("viewBox",`${c.x} ${c.y} ${c.width} ${c.height}`),{newViewBox:c,oldViewBox:h,bbox:l,visibilityList:f,restore:()=>{o.setAttribute("viewBox",m),Object.keys(g).forEach(e=>{const t=document.getElementById(e);if(t){const n=g[e];if(!n)return;"string"==typeof n?t.style.display=n:(void 0!==n.display&&(t.style.display=n.display),void 0!==n.visibility&&(t.style.visibility=n.visibility),void 0!==n.opacity&&(t.style.opacity=n.opacity))}})}}}}});